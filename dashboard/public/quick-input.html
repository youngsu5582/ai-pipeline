<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¹ ë¥¸ ì…ë ¥</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: transparent;
      overflow: hidden;
      -webkit-app-region: drag;
    }

    .container {
      background: linear-gradient(145deg, rgba(102, 126, 234, 0.95), rgba(118, 75, 162, 0.95));
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      -webkit-app-region: no-drag;
    }

    .character {
      width: 48px;
      height: 48px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .greeting {
      color: white;
      font-size: 16px;
      font-weight: 500;
    }

    .input-area {
      -webkit-app-region: no-drag;
    }

    .input-wrapper {
      background: white;
      border-radius: 12px;
      padding: 4px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    #input {
      width: 100%;
      border: none;
      padding: 12px 16px;
      font-size: 15px;
      border-radius: 10px;
      resize: none;
      outline: none;
      min-height: 60px;
      font-family: inherit;
    }

    #input::placeholder {
      color: #999;
    }

    .actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      -webkit-app-region: no-drag;
    }

    .btn {
      flex: 1;
      padding: 10px 16px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary {
      background: white;
      color: #667eea;
    }

    .btn-primary:hover {
      background: #f0f0f0;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .loading {
      display: none;
      text-align: center;
      color: white;
      padding: 20px;
    }

    .loading.active {
      display: block;
    }

    .loading .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 12px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .success {
      display: none;
      text-align: center;
      color: white;
      padding: 20px;
    }

    .success.active {
      display: block;
    }

    .success .icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    .hidden {
      display: none !important;
    }

    /* í‚¤ë³´ë“œ íŒíŠ¸ */
    .hint {
      color: rgba(255, 255, 255, 0.6);
      font-size: 11px;
      text-align: center;
      margin-top: 12px;
    }

    kbd {
      background: rgba(255, 255, 255, 0.2);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: inherit;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="character" id="character">ğŸ¤–</div>
      <div class="greeting" id="greeting">ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</div>
    </div>

    <div class="input-area" id="inputArea">
      <div class="input-wrapper">
        <textarea
          id="input"
          placeholder="ì§€ê¸ˆ í•˜ê³  ìˆëŠ” ì¼, ìƒê°, ì§ˆë¬¸ ë“±..."
          autofocus
        ></textarea>
      </div>

      <div class="actions">
        <button class="btn btn-primary" id="btnRecord" title="ê¸°ë¡í•˜ê¸°">
          ğŸ“ ê¸°ë¡
        </button>
        <button class="btn btn-secondary" id="btnAsk" title="Claudeì—ê²Œ ì§ˆë¬¸">
          ğŸ¤– ì§ˆë¬¸
        </button>
        <button class="btn btn-secondary" id="btnSummary" title="ì˜¤ëŠ˜ ìš”ì•½">
          ğŸ“Š ìš”ì•½
        </button>
      </div>

      <div class="hint">
        <kbd>Enter</kbd> ê¸°ë¡ &nbsp;|&nbsp; <kbd>Esc</kbd> ë‹«ê¸°
      </div>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <div>ì²˜ë¦¬ ì¤‘...</div>
    </div>

    <div class="success" id="success">
      <div class="icon" id="successIcon">âœ¨</div>
      <div id="successMessage">ê¸°ë¡ ì™„ë£Œ!</div>
      <button class="btn btn-secondary" id="btnBack" style="margin-top: 16px; -webkit-app-region: no-drag;">â† ëŒì•„ê°€ê¸°</button>
    </div>
  </div>

  <script>
    const input = document.getElementById('input');
    const inputArea = document.getElementById('inputArea');
    const loading = document.getElementById('loading');
    const success = document.getElementById('success');
    const successMessage = document.getElementById('successMessage');
    const character = document.getElementById('character');
    const greeting = document.getElementById('greeting');

    const greetings = [
      'ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?',
      'ì˜¤ëŠ˜ í•˜ë£¨ ì–´ë•Œìš”?',
      'ì§€ê¸ˆ ë­ í•˜ê³  ìˆì–´ìš”?',
      'ê°„ë‹¨íˆ ë©”ëª¨í•´ë³¼ê¹Œìš”?'
    ];

    // ëœë¤ ì¸ì‚¬ë§
    greeting.textContent = greetings[Math.floor(Math.random() * greetings.length)];

    // ìƒíƒœ í‘œì‹œ
    function showLoading() {
      inputArea.classList.add('hidden');
      loading.classList.add('active');
      success.classList.remove('active');
    }

    function showSuccess(message, autoClose = true) {
      inputArea.classList.add('hidden');
      loading.classList.remove('active');
      success.classList.add('active');
      successMessage.textContent = message;
      character.textContent = 'ğŸ˜Š'; // smile

      // ìë™ ë‹«ê¸° (ì„ íƒì )
      if (autoClose) {
        setTimeout(() => {
          if (window.electronAPI) {
            window.electronAPI.hideWindow();
          }
        }, 1500);
      }
    }

    function showError(message) {
      alert(message);
      inputArea.classList.remove('hidden');
      loading.classList.remove('active');
    }

    function resetUI() {
      inputArea.classList.remove('hidden');
      loading.classList.remove('active');
      success.classList.remove('active');
      input.value = '';
      input.focus();
    }

    // ê¸°ë¡í•˜ê¸°
    async function saveRecord() {
      const text = input.value.trim();
      if (!text) return;

      showLoading();

      try {
        if (window.electronAPI) {
          const result = await window.electronAPI.saveEntry(text, 'quick');
          if (result.success) {
            showSuccess('ê¸°ë¡ ì™„ë£Œ! âœ¨');
          } else {
            showError('ì €ì¥ ì‹¤íŒ¨: ' + result.error);
          }
        } else {
          // í…ŒìŠ¤íŠ¸ìš©
          setTimeout(() => showSuccess('ê¸°ë¡ ì™„ë£Œ! &#10024;'), 500);
        }
      } catch (error) {
        showError('ì˜¤ë¥˜: ' + error.message);
      }
    }

    // Claudeì—ê²Œ ì§ˆë¬¸
    async function askClaude() {
      const text = input.value.trim();
      if (!text) return;

      showLoading();

      try {
        if (window.electronAPI) {
          // Electron í™˜ê²½
          const result = await window.electronAPI.askClaude(text);
          if (result.success) {
            navigator.clipboard.writeText(result.response);
            showSuccess('ì‘ë‹µì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆì–´ìš”!');
          } else {
            showError('ì§ˆë¬¸ ì‹¤íŒ¨: ' + result.error);
          }
        } else {
          // ì›¹ í™˜ê²½ - ì„œë²„ API í˜¸ì¶œ
          const res = await fetch('/api/ask', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt: text })
          });
          const result = await res.json();
          if (result.success) {
            showResponse(result.response);
          } else {
            showError('ì§ˆë¬¸ ì‹¤íŒ¨: ' + result.error);
          }
        }
      } catch (error) {
        showError('ì˜¤ë¥˜: ' + error.message);
      }
    }

    // Claude ì‘ë‹µ í‘œì‹œ
    function showResponse(response) {
      inputArea.classList.add('hidden');
      loading.classList.remove('active');
      success.classList.remove('active');
      character.textContent = 'ğŸ˜Š';

      // ê¸°ì¡´ ì‘ë‹µ ì˜ì—­ ì œê±°
      const existingResponse = document.getElementById('responseArea');
      if (existingResponse) existingResponse.remove();

      // ì‘ë‹µ í‘œì‹œ ì˜ì—­ ìƒì„±
      const responseArea = document.createElement('div');
      responseArea.id = 'responseArea';
      responseArea.innerHTML = `
        <div style="background: rgba(255,255,255,0.95); border-radius: 12px; padding: 16px; margin-bottom: 12px; max-height: 200px; overflow-y: auto; -webkit-app-region: no-drag;">
          <pre style="white-space: pre-wrap; word-break: break-word; font-size: 13px; color: #333; font-family: inherit; margin: 0;">${escapeHtml(response)}</pre>
        </div>
        <div style="display: flex; gap: 8px; -webkit-app-region: no-drag;">
          <button class="btn btn-primary" onclick="copyToClipboard('${escapeHtml(response).replace(/'/g, "\\'")}')">ğŸ“‹ ë³µì‚¬</button>
          <button class="btn btn-secondary" onclick="resetFromResponse()">â† ëŒì•„ê°€ê¸°</button>
        </div>
      `;
      document.querySelector('.container').appendChild(responseArea);
    }

    // HTML ì´ìŠ¤ì¼€ì´í”„
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // í´ë¦½ë³´ë“œ ë³µì‚¬
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showSuccess('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆì–´ìš”!', false);
        setTimeout(resetFromResponse, 1500);
      });
    }

    // ì‘ë‹µ í™”ë©´ì—ì„œ ëŒì•„ê°€ê¸°
    function resetFromResponse() {
      const responseArea = document.getElementById('responseArea');
      if (responseArea) responseArea.remove();
      resetUI();
    }

    // ì˜¤ëŠ˜ ìš”ì•½
    async function showTodaySummary() {
      showLoading();

      try {
        if (window.electronAPI) {
          const entries = await window.electronAPI.getTodayEntries();
          if (entries.length === 0) {
            document.getElementById('successIcon').textContent = 'ğŸ“­';
            showSuccess('ì˜¤ëŠ˜ ê¸°ë¡ì´ ì—†ì–´ìš”', false); // ìë™ ë‹«í˜ ë¹„í™œì„±í™”
          } else {
            // ê¸°ë¡ ëª©ë¡ í‘œì‹œ
            showEntriesList(entries);
          }
        }
      } catch (error) {
        showError('ì˜¤ë¥˜: ' + error.message);
      }
    }

    // ê¸°ë¡ ëª©ë¡ í‘œì‹œ
    function showEntriesList(entries) {
      inputArea.classList.add('hidden');
      loading.classList.remove('active');
      success.classList.remove('active');

      // ê¸°ë¡ ëª©ë¡ HTML ìƒì„±
      let html = '<div class="entries-list" style="max-height: 200px; overflow-y: auto; background: rgba(255,255,255,0.95); border-radius: 12px; padding: 12px; margin-bottom: 12px; -webkit-app-region: no-drag;">';
      html += '<h4 style="color: #667eea; margin-bottom: 8px; font-size: 14px;">ğŸ“‹ ì˜¤ëŠ˜ì˜ ê¸°ë¡ (' + entries.length + 'ê°œ)</h4>';

      entries.forEach(e => {
        const time = new Date(e.time).toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
        html += '<div style="padding: 6px 0; border-bottom: 1px solid #eee; font-size: 13px; color: #333;">';
        html += '<span style="color: #999; margin-right: 8px;">' + time + '</span>' + (e.text || e.raw || '');
        html += '</div>';
      });

      html += '</div>';
      html += '<button class="btn btn-secondary" id="btnBackFromList" style="-webkit-app-region: no-drag;">â† ëŒì•„ê°€ê¸°</button>';

      // ì»¨í…Œì´ë„ˆì— ì¶”ê°€
      const container = document.querySelector('.container');
      const entriesDiv = document.createElement('div');
      entriesDiv.id = 'entriesView';
      entriesDiv.innerHTML = html;
      container.appendChild(entriesDiv);

      document.getElementById('btnBackFromList').addEventListener('click', () => {
        entriesDiv.remove();
        resetUI();
      });
    }

    // ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('btnRecord').addEventListener('click', saveRecord);
    document.getElementById('btnAsk').addEventListener('click', askClaude);
    document.getElementById('btnSummary').addEventListener('click', showTodaySummary);
    document.getElementById('btnBack').addEventListener('click', () => {
      document.getElementById('successIcon').textContent = 'âœ¨';
      resetUI();
    });

    // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        saveRecord();
      } else if (e.key === 'Escape') {
        if (window.electronAPI) {
          window.electronAPI.hideWindow();
        }
      }
    });

    // í¬ì»¤ìŠ¤
    input.focus();
  </script>
</body>
</html>
